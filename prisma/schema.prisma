// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

//||||||||||||||||##########||||||||||||||||//
//                   USER                   //
//||||||||||||||||##########||||||||||||||||//
model User {
  id                  String              @id @default(uuid())
  googleId            String?             @unique
  githubId            Int?                @unique
  createdAt           DateTime            @default(now())
  updatedAt           DateTime            @updatedAt
  completedOnboarding Boolean             @default(false)
  currentUrl          String?
  courseProgress      CourseProgress[]
  moduleProgress      ModuleProgress[]
  subModuleProgress   SubModuleProgress[]
  lessonProgress      LessonProgress[]
  tests               Test[]
  checkpoints         Checkpoint[]
  projects            Project[]
  badges              Badge[]
}

//||||||||||||||||##########||||||||||||||||//
//                  COURSE                  //
//||||||||||||||||##########||||||||||||||||//
model Course {
  id        String   @id @default(uuid())
  title     String
  slug      String
  published Boolean
  jsonId    String   @unique
  modules   Module[]
}

model Module {
  id         String      @id @default(uuid())
  title      String
  slug       String
  jsonId     String      @unique
  courseId   String
  course     Course      @relation(fields: [courseId], references: [id])
  subModules SubModule[]
}

model SubModule {
  id       String   @id @default(uuid())
  title    String
  slug     String
  jsonId   String   @unique
  moduleId String
  lessons  Lesson[]
  module   Module   @relation(fields: [moduleId], references: [id])
}

model Lesson {
  id          String    @id @default(uuid())
  title       String
  slug        String
  jsonId      String    @unique
  subModuleId String
  subModule   SubModule @relation(fields: [subModuleId], references: [id])
}

//||||||||||||||||##########||||||||||||||||//
//                 PROGRESS                 //
//||||||||||||||||##########||||||||||||||||//
model CourseProgress {
  id             String           @id @default(uuid())
  title          String
  slug           String
  userId         String
  score          Int              @default(0)
  projectId      String
  status         String           @default("IN_PROGRESS") //IN_PROGRESS, COMPLETED
  user           User             @relation(fields: [userId], references: [id])
  moduleProgress ModuleProgress[]
  project        Project          @relation(fields: [projectId], references: [id])
}

model ModuleProgress {
  id                String              @id @default(uuid())
  title             String
  slug              String
  userId            String
  courseProgressId  String
  score             Int                 @default(0)
  testId            String              @unique
  checkpointId      String
  status            String              @default("LOCKED") //LOCKED, IN_PROGRESS, COMPLETED
  user              User                @relation(fields: [userId], references: [id])
  courseProgress    CourseProgress      @relation(fields: [courseProgressId], references: [id])
  subModuleProgress SubModuleProgress[]
  badges            Badge[]
  test              Test                @relation(fields: [testId], references: [id])
  checkpoint        Checkpoint          @relation(fields: [checkpointId], references: [id])
}

model SubModuleProgress {
  id               String           @id @default(uuid())
  title            String
  slug             String
  userId           String
  score            Int              @default(0)
  moduleProgressId String
  testId           String           @unique
  checkpointId     String
  status           String           @default("LOCKED") //LOCKED, IN_PROGRESS, COMPLETED
  user             User             @relation(fields: [userId], references: [id])
  moduleProgress   ModuleProgress   @relation(fields: [moduleProgressId], references: [id])
  lessonProgress   LessonProgress[]
  test             Test             @relation(fields: [testId], references: [id])
  checkpoint       Checkpoint       @relation(fields: [checkpointId], references: [id])
}

model LessonProgress {
  id                  String            @id @default(uuid())
  title               String
  slug                String
  userId              String
  status              String            @default("LOCKED") //LOCKED, IN_PROGRESS, COMPLETED
  subModuleProgressId String
  user                User              @relation(fields: [userId], references: [id])
  subModuleProgress   SubModuleProgress @relation(fields: [subModuleProgressId], references: [id])
}

model Badge {
  id                   String         @id @default(uuid())
  title                String
  locked_description   String
  unlocked_description String
  level                String // NOVICE, ADEPT, PROFICIENT, VIRTUOSO
  status               String         @default("LOCKED") //LOCKED, UNLOCKED
  userId               String
  moduleProgressId     String
  user                 User           @relation(fields: [userId], references: [id])
  moduleProgress       ModuleProgress @relation(fields: [moduleProgressId], references: [id])
}

model Checkpoint {
  id                  String              @id @default(uuid())
  title               String
  score               Int                 @default(0)
  status              String              @default("LOCKED") //LOCKED, IN_PROGRESS, COMPLETED
  userId              String
  moduleProgressId    String?
  subModuleProgressId String?
  user                User                @relation(fields: [userId], references: [id])
  moduleProgress      ModuleProgress[]
  subModuleProgress   SubModuleProgress[]
}

model Test {
  id                  String              @id @default(uuid())
  title               String
  status              String              @default("LOCKED") //LOCKED,  COMPLETED
  score               Int                 @default(0)
  attempts            Int                 @default(0)
  attempted           Boolean             @default(false)
  nextAttemptAt       DateTime?
  userId              String
  moduleProgressId    String?
  subModuleProgressId String?
  user                User                @relation(fields: [userId], references: [id])
  moduleProgress      ModuleProgress[]
  subModuleProgress   SubModuleProgress[]
}

//||||||||||||||||##########||||||||||||||||//
//                 PROJECT                  //
//||||||||||||||||##########||||||||||||||||//

model Project {
  id             String           @id @default(uuid())
  title          String
  slug           String
  status         String           @default("LOCKED") //LOCKED, IN_PROGRESS, COMPLETED
  userId         String
  user           User             @relation(fields: [userId], references: [id])
  courseProgress CourseProgress[]
}
